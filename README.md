# Intent

`intent` is a small, safety-first tool for keeping project configuration in sync
by generating tool-owned files from a single source of truth.

It refuses to overwrite user-managed files, guarantees idempotent and atomic
writes, and is intentionally boring by design,

while **strictly respecting ownership of existing tools** like `pyproject.toml`.


---

## Why Intent Exists

Modern Python projects repeat the same information in many places:

* Python version in `pyproject.toml`, CI, Docker, docs
* Test and lint commands in CI, Makefiles, Justfiles, READMEs

Over time, these drift.

Intent solves **coordination drift**, not packaging, not builds, not dependencies.

---

## What Intent Is

* A **single source of agreement**
* A **projection tool**, not a configuration manager
* A **consistency governor**, not a framework

You declare intent once, and Intent projects it deterministically.

---

## What Intent Is Not

Intent does **not**:

* Manage dependencies
* Replace `pyproject.toml`
* Configure tools like `pytest`, `ruff`, or `black`
* Guess defaults
* Merge user-edited files

If a file is not owned by Intent, Intent will not touch it.

---

## Core Concepts

### Intent File (`intent.toml`)

The only file you author.

```toml
[python]
version = "3.12"

[commands]
test = "pytest -q"
lint = "ruff check ."
```

This file describes **agreements**, not implementations.

---

### Canonical Files (Read-Only)

Some files are owned by the ecosystem, not by Intent.

Examples:

* `pyproject.toml`

Intent will:

* read them
* validate consistency
* fail loudly on mismatch

Intent will **never modify them**.

---

### Generated Files (Tool-Owned)

Intent generates files it fully owns:

* `.github/workflows/ci.yml`
* `justfile`

These files:

* contain a `# GENERATED BY intent` marker
* are written atomically
* are overwritten safely
* refuse overwrite if user-edited

---

## Features Implemented (Current State)

### ✅ Config loading & validation

* Parses `intent.toml`
* Validates required structure
* Clear error messages

### ✅ Python version consistency

* Reads `requires-python` from `pyproject.toml`
* Supports:

  * exact versions
  * basic range checks
* Skips unsupported patterns safely

### ✅ CI rendering (preview + write)

* Renders minimal GitHub Actions workflow
* Projects:

  * Python version
  * declared commands
* Deterministic output

### ✅ Justfile rendering (preview + write)

* Generates one recipe per command
* Includes default recipe
* Deterministic output

### ✅ Safe, idempotent file writes

* Atomic writes (POSIX-safe)
* Ownership enforcement
* No accidental overwrites

### ✅ Test coverage

* Config parsing
* Version checks
* CI rendering
* Justfile rendering
* Filesystem safety & idempotency

---

## Usage

### Preview generated files

```bash
python -m intent.cli sync --show-ci
python -m intent.cli sync --show-just
```

### Write generated files

```bash
python -m intent.cli sync --write
```

* Writes:

  * `.github/workflows/ci.yml`
  * `justfile`
* Refuses to overwrite user-owned files
* Idempotent (safe to run repeatedly)

---

## Design Principles

* **Explicit over clever**
* **Projection over mutation**
* **Ownership is sacred**
* **Idempotency by default**
* **Fail loudly on ambiguity**

---

## Project Status

**MVP complete.**

Next possible directions (not yet implemented):

* Additional projections (pre-commit, devcontainers)
* Dry-run summaries
* Better version spec support
* Plugin system (carefully scoped)

All future work will preserve the same boundaries.

---

## License

TBD
